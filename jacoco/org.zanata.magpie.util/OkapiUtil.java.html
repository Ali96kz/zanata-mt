<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OkapiUtil.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">mt-server</a> &gt; <a href="index.source.html" class="el_package">org.zanata.magpie.util</a> &gt; <span class="el_source">OkapiUtil.java</span></div><h1>OkapiUtil.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2017, Red Hat, Inc. and individual contributors as indicated by the
 * @author tags. See the copyright.txt file in the distribution for a full
 * listing of individual contributors.
 *
 * This is free software; you can redistribute it and/or modify it under the
 * terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation; either version 2.1 of the License, or (at your option)
 * any later version.
 *
 * This software is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this software; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA, or see the FSF
 * site: http://www.fsf.org.
 */
package org.zanata.magpie.util;

import net.sf.okapi.common.LocaleId;
import net.sf.okapi.steps.tokenization.Tokenizer;
import net.sf.okapi.steps.tokenization.tokens.Tokens;
import org.apache.commons.lang3.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import javax.validation.constraints.NotNull;

public class OkapiUtil {
<span class="fc" id="L33">    private static final Logger log = LoggerFactory.getLogger(OkapiUtil.class);</span>

<span class="nc" id="L35">    private OkapiUtil() {</span>
<span class="nc" id="L36">    }</span>

    /**
     * Count words using Okapi's WordCounter, which tries to implement the LISA
     * standard &lt;a href=
     * &quot;http://web.archive.org/web/20090403134742/http://www.lisa.org/Global-information-m.105.0.html&quot;
     * &gt;GMX-V&lt;/a&gt;
     *
     * @param content
     * @param localeCode
     */
    public static long countWords(@NotNull String content,
            @NotNull String localeCode) {
<span class="pc bpc" id="L49" title="1 of 4 branches missed.">        if (StringUtils.isBlank(content) || StringUtils.isBlank(localeCode)) {</span>
<span class="fc" id="L50">            return 0;</span>
        }
        try {
            LocaleId locale;
            try {
<span class="fc" id="L55">                locale = LocaleId.fromBCP47(localeCode);</span>
<span class="nc" id="L56">            } catch (Exception e) {</span>
<span class="nc" id="L57">                log.error(</span>
                        &quot;can't understand '{}' as a BCP-47 locale; defaulting to English&quot;,
                        localeCode);
<span class="nc" id="L60">                locale = LocaleId.ENGLISH;</span>
<span class="fc" id="L61">            }</span>

<span class="fc" id="L63">            Tokens tokens = StringTokenizer.tokenizeString(content, locale, &quot;WORD&quot;);</span>
<span class="fc" id="L64">            return tokens.size();</span>
<span class="nc" id="L65">        } catch (Exception e) {</span>
<span class="nc" id="L66">            Object[] args = new Object[] { content, localeCode, e };</span>
<span class="nc" id="L67">            log.error(&quot;unable to count words in string '{}' for locale '{}'&quot;,</span>
                    args);
<span class="nc" id="L69">            return 0;</span>
        }
    }

<span class="nc" id="L73">    private static class StringTokenizer extends Tokenizer {</span>
        public static Tokens tokenizeString(String text, LocaleId language,
                String... tokenNames) {
<span class="fc" id="L76">            synchronized (Tokenizer.class) {</span>
<span class="fc" id="L77">                return Tokenizer.tokenizeString(text, language, tokenNames);</span>
<span class="nc" id="L78">            }</span>
        }
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>